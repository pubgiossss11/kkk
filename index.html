<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Táº­p HoÃ¡ 2k</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<header class="header">
  <div class="brand">
    <div class="logo"><img src="assets/logo.svg" alt="T2K" style="width:36px;height:36px;border-radius:50%"></div>
    <div class="site-title">Táº­p HoÃ¡ 2k</div>
  </div>
  <div class="nav">
    <div id="statusArea" class="small">Äang táº£i...</div>
    <button id="btnLogin" class="btn">ÄÄƒng nháº­p</button>
    <button id="btnLogout" class="btn ghost hidden">ÄÄƒng xuáº¥t</button>
    <button id="themeToggle" class="btn hide-mobile">Äá»•i giao diá»‡n</button>
  </div>
</header>

<main class="container">
  <!-- ğŸ”¹ Lá»i chÃ o ngÆ°á»i dÃ¹ng -->
  <section id="welcomeCard" class="card" style="display:none;">
    <h3>Xin chÃ o, <span id="userName"></span> ğŸ‘‹</h3>
    <p class="small">ChÃºc báº¡n mua sáº¯m vui váº» táº¡i Táº­p HoÃ¡ 2k!</p>
  </section>

  <!-- ğŸ”¹ Pháº§n náº¡p tiá»n (áº©n máº·c Ä‘á»‹nh) -->
  <section id="depositSection" class="card" style="margin-top:16px; display:none;">
    <h3>Náº¡p tiá»n</h3>
    <div class="form-row">
      <input id="depositAmount" type="number" min="1000" class="input" placeholder="Nháº­p sá»‘ tiá»n (VNÄ)" required>
    </div>
    <div class="row">
      <button type="button" class="btn primary" onclick="napTien()">Náº¡p ngay</button>
      <button type="button" class="btn" onclick="xemSoDu()">Xem sá»‘ dÆ°</button>
    </div>
    <div id="depositMessage" class="small" style="color:#7effa0;margin-top:8px"></div>
  </section>

  <section class="card">
    <h2>ChÃºng tÃ´i cung cáº¥p</h2>
    <p class="small">Shop chuyÃªn acc game, an toÃ n vÃ  nhanh chÃ³ng. Chá»n sáº£n pháº©m vÃ  Ä‘áº·t hÃ ng â€” chÃºng tÃ´i sáº½ liÃªn há»‡ qua Telegram.</p>
  </section>

  <section class="card">
    <h3>Sáº£n pháº©m ná»•i báº­t</h3>
    <div id="products" class="grid"></div>
  </section>
</main>

<footer class="footer">Â© Táº­p HoÃ¡ 2k</footer>

<div class="fab">
  <button id="btnCart" class="btn primary">Giá» hÃ ng <span id="cartCount" class="count">0</span></button>
</div>

<script src="common.js"></script>
<script>
// ====================== QUáº¢N LÃ NGÆ¯á»œI DÃ™NG =========================
window.addEventListener('DOMContentLoaded', ()=>{
  const current = getCurrentUser?.();
  const depositSection = document.getElementById('depositSection');
  const welcomeCard = document.getElementById('welcomeCard');
  const userName = document.getElementById('userName');
  const btnLogin = document.getElementById('btnLogin');
  const btnLogout = document.getElementById('btnLogout');
  const statusArea = document.getElementById('statusArea');

  if (current && current.username) {
    // Náº¿u Ä‘Ã£ Ä‘Äƒng nháº­p
    depositSection.style.display = 'block';
    welcomeCard.style.display = 'block';
    userName.textContent = current.display || current.username;
    btnLogin.classList.add('hidden');
    btnLogout.classList.remove('hidden');
    statusArea.textContent = 'ÄÃ£ Ä‘Äƒng nháº­p';
  } else {
    // Náº¿u chÆ°a Ä‘Äƒng nháº­p
    depositSection.style.display = 'none';
    welcomeCard.style.display = 'none';
    btnLogin.classList.remove('hidden');
    btnLogout.classList.add('hidden');
    statusArea.textContent = 'ChÆ°a Ä‘Äƒng nháº­p';
  }
});

// ====================== CHá»¨C NÄ‚NG Náº P TIá»€N =========================
function napTien() {
  const soTien = parseInt(document.getElementById('depositAmount').value);
  const msg = document.getElementById('depositMessage');
  if (!soTien || soTien < 1000) {
    msg.style.color = '#ff8b8b';
    msg.textContent = 'Vui lÃ²ng nháº­p sá»‘ tiá»n há»£p lá»‡ (tá»‘i thiá»ƒu 1.000Ä‘)';
    return;
  }

  const current = getCurrentUser?.();
  if (!current) {
    msg.style.color = '#ff8b8b';
    msg.textContent = 'Vui lÃ²ng Ä‘Äƒng nháº­p trÆ°á»›c khi náº¡p tiá»n!';
    return;
  }

  const user = findUser(current.username);
  if (user) {
    user.balance = (user.balance || 0) + soTien;
    saveUser(user);
    msg.style.color = '#7effa0';
    msg.textContent = 'âœ… Náº¡p thÃ nh cÃ´ng ' + soTien.toLocaleString('vi-VN') + 'Ä‘!';
  } else {
    msg.style.color = '#ff8b8b';
    msg.textContent = 'KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng!';
  }
}

function xemSoDu() {
  const msg = document.getElementById('depositMessage');
  const current = getCurrentUser?.();
  if (!current) {
    msg.style.color = '#ff8b8b';
    msg.textContent = 'Báº¡n chÆ°a Ä‘Äƒng nháº­p!';
    return;
  }
  const user = findUser(current.username);
  if (user) {
    msg.style.color = '#7effa0';
    msg.textContent = 'ğŸ’° Sá»‘ dÆ° hiá»‡n táº¡i: ' + (user.balance || 0).toLocaleString('vi-VN') + 'Ä‘';
  }
}

// ====================== Sáº¢N PHáº¨M VÃ€ GIá» HÃ€NG =========================
const PRODUCTS = [
  {id:'p1', title:'Acc Valorant Silver', desc:'Rank Silver, email gá»‘c', price:350000},
  {id:'p2', title:'Acc LiÃªn QuÃ¢n Báº¡ch Kim', desc:'Nhiá»u skin', price:890000},
  {id:'p3', title:'Acc Genshin AR45', desc:'NhÃ¢n váº­t hiáº¿m', price:1500000}
];

function renderProducts(){
  const wrap = document.getElementById('products'); 
  wrap.innerHTML='';
  PRODUCTS.forEach(p=>{
    const el = document.createElement('div'); el.className='product card';
    el.innerHTML = `
      <div class="thumb">ğŸ®</div>
      <h4>${p.title}</h4>
      <p class="small">${p.desc}</p>
      <div class="row" style="justify-content:space-between">
        <div class="price">${fmt(p.price)}</div>
        <button class="btn primary" data-id="${p.id}">ThÃªm</button>
      </div>`;
    wrap.appendChild(el);
  });
}

let CART = JSON.parse(localStorage.getItem('cart')||'[]');
function saveCart(){ localStorage.setItem('cart', JSON.stringify(CART)); updateCartCount(); }
function updateCartCount(){ document.getElementById('cartCount').textContent = CART.reduce((s,i)=>s+i.qty,0); }

document.addEventListener('click', (e)=>{
  const btn = e.target.closest('[data-id]');
  if(btn){
    const id = btn.dataset.id;
    const p = PRODUCTS.find(x=>x.id===id);
    const f = CART.find(x=>x.id===id);
    if(f) f.qty++; else CART.push({...p, qty:1});
    saveCart();
    alert('ÄÃ£ thÃªm vÃ o giá»');
  }
});

document.getElementById('btnCart').addEventListener('click', ()=>{ window.location.href='order.html'; });
document.getElementById('btnLogin').addEventListener('click', ()=>{ window.location.href='login.html'; });
document.getElementById('btnLogout').addEventListener('click', ()=>{ logout(); });
document.getElementById('themeToggle').addEventListener('click', ()=>{ toggleTheme(); });

renderProducts(); updateCartCount();
</script>
</body>
</html>